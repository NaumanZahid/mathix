class NextMatrix  
  attr_accessor :raw_data
        
        
  def initialize(params=nil)    
    @raw_data = []
    extract_params(params) unless params.nil?
  end

  def to_s
    result = ""
    @raw_data.each do |row|
      result << row.map{|item| item.to_s.rjust(4) }.join(" ")
      result << "\n"
    end 
    result << "\n"  
    result
  end

  def rows(index=nil)
    index.nil? ? @raw_data : @raw_data[index-1]
  end

  def cols(index=nil)
    if index.nil? 
      cols = []
      max_cols = @raw_data[0].length - 1

      0.upto(max_cols) do |col_index|       
        cols << @raw_data.map{|row| row[col_index] }
      end
      cols
    else
      @raw_data.map{|row| row[index-1] }
    end
  end

  def add_row(row)
    if @raw_data.size == 0
      @raw_data << row
    elsif row.size == @raw_data[0].size
      @raw_data << row
    else
      raise "New row size does not match"
    end
  end

  def add_column(col)
    if @raw_data.size > 0 
      @raw_data.each_with_index do |row, index|
        row << col[index]
      end
    else
      col.map{|item| @raw_data << [item] }
    end
  end

  def cardinatily
    @raw_data.size == 0 ? {rows: 0,cols: 0} : {rows: @raw_data.size,cols: @raw_data[0].size}
  end

  def self.matrix2string(matrix)
        result = "["
        @count=0
        matrix.raw_data.each do |row|
          @count +=1
          result << row.map{|item| item.to_s}.join(" ")
          if(@count!=matrix.raw_data.size)
            result << " | "
          end
        end
        result=result+"]"
        result=result.tr('[]','')
        result
    end
  
  #-----------------------------------------------------------------------------------------
  def scalarmultiply(num)
      m = NextMatrix.new
      1.upto(self.cardinatily[:rows]) do |row_index|
        row_m1 = self.rows(row_index)     
          row = []
          row_m1.each_with_index{|item, index| row << (item * num) }                
            m.add_row row
      end
      m
  end


=begin  def self.display(matrix1)
                  
    result=''
    i=0
    matrix1.raw_data.each do |row|
        row.map{|item|
           result=result+item.to_s
          i=i+1
          if(i!=matrix1.cardinatily[:rows])
           result=result+'&'  
            
          elsif(i==matrix1.cardinatily[:rows])
            result=result+'\\\\'
            i=0         
          end 
        } 
    end
    return result;  

  end
=end

  def formatize
    @result = ""
    @raw_data.each do |row|
      @result << row.map{|item| item.to_s }.join("&")
      @result << "\\\\"
    end
    @result
  end

  def negativeMatrix()
      m = NextMatrix.new
      1.upto(self.cardinatily[:rows]) do |row_index|
        row_m1 = self.rows(row_index)     
          row = []
          row_m1.each_with_index{|item, index| row << (item * -1) }               
            m.add_row row
      end
      m
  end

  def add(m2)

    if self.cardinatily == m2.cardinatily
      m = NextMatrix.new
      1.upto(self.cardinatily[:rows]) do |index|
        row_m1 = self.rows(index)
        row_m2 = m2.rows(index)
        row = []
        row_m1.each_with_index { |item, index| row << (item + row_m2[index]) }
        m.add_row(row)
      end
      m
    else
      raise "Cardinality does not match"
    end
  end

  def subtract(m2)
    if self.cardinatily == m2.cardinatily
      m = NextMatrix.new
      1.upto(self.cardinatily[:rows]) do |index|
        row_m1 = self.rows(index)
        row_m2 = m2.rows(index)
        row = []
        row_m1.each_with_index{|item, index| row << (item - row_m2[index]) }
        m.add_row row
      end
      m
    else
      raise "Cardinality does not match"
    end
  end

  def multiply(m2)
    if self.cardinatily[:cols] == m2.cardinatily[:rows]
      m = NextMatrix.new
      1.upto(self.cardinatily[:rows]) do |row_index|
        resultant_row = []
        row_m1 = self.rows(row_index)
        1.upto(m2.cardinatily[:cols]) do |col_index|
          col_m2 = m2.cols(col_index)
          row = []
          row_m1.each_with_index{|item, index| row << (item * col_m2[index]) }
          resultant_row << row.inject(&:+)
        end
        m.add_row(resultant_row)
      end
      m
    else
      raise "Cardinality for multiplication does not match"
    end
  end
  
  #-----------------------------------------------------------------------------------------

  private
  def extract_params(params)
    # [[1,2,4],[1,4,6],[4,5,9]]
    if params.is_a? Array
      @raw_data = params
    # 1 2 3 | 4 5 6 | 7 8 9
    elsif params.is_a? String
      @raw_data = params.split("|").map{|row| row.split(" ").map!{|num| num.strip.to_i} }   
    end
  end
  
  
end




